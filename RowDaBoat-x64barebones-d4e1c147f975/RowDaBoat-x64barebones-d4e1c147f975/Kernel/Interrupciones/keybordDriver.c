#include "keyboradDriver.h"
#include "../video_driver.h"
#include "../include/naiveConsole.h"
extern unsigned char getKeyboardScanCode();

static const char asccode[58][2] = 
{
    {0, 0}, {0, 0}, {'1', '!'}, {'2', '@'}, {'3', '#'}, {'4', '$'},
    {'5', '%'}, {'6', '^'}, {'7', '&'}, {'8', '*'}, {'9', '('},
    {'0', ')'}, {'-', '_'}, {'-', '+'}, {'\b', '\b'}, {'\t', '\t'}, 
    {'q', 'Q'}, {'w', 'W'}, {'e', 'E'}, {'r', 'R'}, {'t', 'T'}, {'y', 'Y'}, 
    {'u', 'U'}, {'i', 'I'}, {'o', 'O'}, {'p', 'P'}, {'[', '{'}, {']', '}'}, 
    {'\n', '\n'}, {0, 0}, {'a', 'A'}, {'s', 'S'}, {'d', 'D'}, {'f', 'F'}, {'g', 'G'}, 
    {'h', 'H'}, {'j', 'J'}, {'k', 'K'}, {'l', 'L'}, {';', ':'}, {'\'', '\"'}, {'°', '~'}, 
    {0, 0}, {'\\', '|'}, {'z', 'Z'}, {'x', 'X'}, {'c', 'C'}, {'v', 'V'}, {'b', 'B'}, {'n', 'N'}, 
    {'m', 'M'}, {',', '<'}, {'.', '>'}, {'/', '?'}, {0, 0}, {0, 0}, {0, 0}, {' ', ' '}
};

static const char latinasccode[86][3] =
{
    {0, 0, 0}, {0, 0, 0}, {'1', '!','|'}, {'2', '"','@'}, {'3', '#',0}, {'4', '$','~'},
    {'5', '%',0}, {'6', '&', '¬'}, {'7', '/', '{'}, {'8', '(' ,'['}, {'9', ')',']'},
    {'0', '=','}'}, {'\'', '?','\\'}, {'¿', '¡','¸'}, {'\b', '\b',0}, {'\t', '\t',0}, 
    {'q', 'Q','@'}, {'w', 'W',0}, {'e', 'E',0}, {'r', 'R',0}, {'t', 'T',0}, {'y', 'Y',0}, 
    {'u', 'U',0}, {'i', 'I',0}, {'o', 'O',0}, {'p', 'P',0}, {'´', '¨','¨'}, {'+', '*','~'}, 
    {'\n', '\n',0}, {0, 0,0}, {'a', 'A',0}, {'s', 'S',0}, {'d', 'D',0}, {'f', 'F',0}, {'g', 'G',0}, 
    {'h', 'H',0}, {'j', 'J',0}, {'k', 'K',0}, {'l', 'L',0},{'ñ','Ñ',0} ,{'{', '[','^'}, {'|', '°','¬'}, {0, 0,0}, 
    {'}', ']','`'}, {'z', 'Z',0}, {'x', 'X',0}, {'c', 'C',0}, {'v', 'V',0}, {'b', 'B',0}, {'n', 'N',0}, 
    {'m', 'M',0}, {',', ';',0}, {'.', ':',0}, {'-', '_',0}, {0,0,0}, {0,0,0}, {0,0,0}, {' ', ' ',' '},
    {0,0,0}, {0,0,0}, {0,0,0},{0,0,0}, {0,0,0}, {0,0,0},{0,0,0}, {0,0,0}, {0,0,0},{0,0,0},{0,0,0}, {0,0,0}, {0,0,0},{0, 0,0}
    ,{0,0,0}, {0,0,0}, {0,0,0},{0,0,0}, {0,0,0},{0,0,0}, {0,0,0}, {0,0,0},{0,0,0}, {0,0,0},{0,0,0}, {0,0,0}, {0,0,0},{'<','>','|'}
};
static const char special[2] = {0,0};
void keyboardHandler()
{
    signed long scan = getKeyboardScanCode();
    static int shift=0;
    if(scan <=0x56){
        if(scan == 0x2A ||scan == 0x36)
        {
            shift=1;
            keyboardHandler();
        }else if(scan == 14)
        {
            deleteChar();
        }else if(scan == 0x38)
        {
            shift=2;
            keyboardHandler();
        }else if(scan == 0x3A)
        {
            shift=!shift;

        }else if(scan == 0x1C)
        {
            newLine();
            keyboardHandler();
        }else{
            printChar(latinasccode[scan][shift]);
        }
    }
    else if(scan == 0xAA)
    {
        shift=0;
    }
    



}